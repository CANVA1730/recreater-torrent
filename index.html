<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZIP â†’ Torrent | Convertidor</title>

<style>
:root {
  --bg: #0b0f19;
  --surface: #111827;
  --surface-light: #1e293b;
  --primary: #3b82f6;
  --primary-hover: #60a5fa;
  --text: #f8fafc;
  --muted: #9ca3af;
  --radius: 12px;
  --shadow: 0 8px 30px rgba(0,0,0,0.4);
  --transition: 0.25s ease;
}

body {
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, Roboto, Arial;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

.card {
  background: var(--surface);
  padding: 2rem 2.2rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 480px;
  border: 1px solid #1f2937;
  position: relative;
}

/* ==== BOTÃ“N DE IDIOMA PEQUEÃ‘O ==== */
.lang-btn {
  position: absolute;
  top: 0.8rem;
  right: 0.8rem;
  background: var(--surface-light);
  color: var(--text);
  border: 1px solid #334155;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
.lang-btn:hover {
  background: var(--primary);
  transform: scale(1.1);
}

h1 {
  text-align: center;
  font-size: 1.7rem;
  margin-top: 0.5rem;
  color: var(--primary-hover);
}

p.subtitle {
  text-align: center;
  color: var(--muted);
  margin-bottom: 1.5rem;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 1.2rem;
  margin-bottom: 0.4rem;
  color: #e2e8f0;
}

input[type="file"],
input[type="text"] {
  width: 100%;
  padding: 0.7rem 0.9rem;
  font-size: 0.95rem;
  border: 1px solid #334155;
  border-radius: var(--radius);
  background: var(--surface-light);
  color: var(--text);
  transition: border var(--transition), box-shadow var(--transition);
}

input::placeholder {
  color: #6b7280;
}

input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(59,130,246,0.3);
}

button {
  width: 100%;
  margin-top: 1.8rem;
  padding: 0.9rem 1.1rem;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
}

button:hover {
  background: var(--primary-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59,130,246,0.3);
}

progress {
  width: 100%;
  height: 10px;
  margin-top: 1rem;
  appearance: none;
  border: none;
  border-radius: 8px;
  overflow: hidden;
}
progress::-webkit-progress-bar {
  background: #1e293b;
}
progress::-webkit-progress-value {
  background: var(--primary);
}

#status {
  margin-top: 1rem;
  font-size: 0.9rem;
  text-align: center;
}

pre {
  background: #1e293b;
  border-radius: var(--radius);
  padding: 0.8rem;
  margin-top: 1rem;
  font-size: 0.8rem;
  overflow-x: auto;
  color: #e2e8f0;
}
</style>
</head>

<body>
  <div class="card">
    <button id="lang-toggle" class="lang-btn" title="Cambiar idioma">ðŸ‡ºðŸ‡¸</button>

    <h1 id="title">Convertidor ZIP â†’ Torrent</h1>
    <p id="subtitle" class="subtitle">Crea tu archivo <code>.torrent</code> localmente â€” sin subir nada a Internet.</p>

    <label id="label-zip" for="zip">Archivo ZIP</label>
    <input id="zip" type="file" accept=".zip,application/zip" />

    <label id="label-tracker" for="tracker">URL del tracker (opcional)</label>
    <input id="tracker" type="text" placeholder="https://tracker.example/announce" />

    <label id="label-piece" for="piecesize">TamaÃ±o de pieza (bytes)</label>
    <input id="piecesize" type="text" placeholder="Ej: 262144 (256 KiB)" />

    <button id="generate">Generar .torrent</button>

    <progress id="progress" value="0" max="100" style="display:none"></progress>
    <div id="status"></div>
    <pre id="infoPreview">â€”</pre>
  </div>

<script>
/* ====== Diccionario de idiomas ====== */
const i18n = {
  es: {
    title: "Convertidor ZIP â†’ Torrent",
    subtitle: "Crea tu archivo .torrent localmente â€” sin subir nada a Internet.",
    zip: "Archivo ZIP",
    tracker: "URL del tracker (opcional)",
    piece: "TamaÃ±o de pieza (bytes)",
    button: "Generar .torrent",
    select: "Selecciona un archivo ZIP.",
    hashing: "Calculando piezas...",
    done: "âœ… Torrent generado correctamente.",
    error: "Error generando .torrent: ",
  },
  en: {
    title: "ZIP â†’ Torrent Converter",
    subtitle: "Create your .torrent file locally â€” no upload required.",
    zip: "ZIP File",
    tracker: "Tracker URL (optional)",
    piece: "Piece size (bytes)",
    button: "Generate .torrent",
    select: "Please select a ZIP file.",
    hashing: "Calculating pieces...",
    done: "âœ… Torrent successfully generated.",
    error: "Error generating .torrent: ",
  }
};

let lang = "es";

/* ====== Cambiar idioma ====== */
function switchLang() {
  lang = lang === "es" ? "en" : "es";
  const t = i18n[lang];
  document.getElementById("lang-toggle").textContent = lang === "es" ? "ðŸ‡ºðŸ‡¸" : "ðŸ‡ªðŸ‡¸";
  document.getElementById("title").textContent = t.title;
  document.getElementById("subtitle").textContent = t.subtitle;
  document.getElementById("label-zip").textContent = t.zip;
  document.getElementById("label-tracker").textContent = t.tracker;
  document.getElementById("label-piece").textContent = t.piece;
  document.getElementById("generate").textContent = t.button;
  document.getElementById("piecesize").placeholder = lang === "es" ? "Ej: 262144 (256 KiB)" : "Ex: 262144 (256 KiB)";
}
document.getElementById("lang-toggle").addEventListener("click", switchLang);

/* ====== LÃ³gica del generador de torrent ====== */
function utf8ToBytes(str){return new TextEncoder().encode(str);}
function concatUint8(arrs){let l=arrs.reduce((s,a)=>s+a.length,0),r=new Uint8Array(l),o=0;for(const a of arrs){r.set(a,o);o+=a.length;}return r;}
function bencode(v){
  if(v===null||v===undefined)return utf8ToBytes('');
  if(v instanceof Uint8Array){const len=utf8ToBytes(String(v.length));return concatUint8([len,utf8ToBytes(':'),v]);}
  if(typeof v==='string'){const b=utf8ToBytes(v);return concatUint8([utf8ToBytes(String(b.length)),utf8ToBytes(':'),b]);}
  if(typeof v==='number')return utf8ToBytes(`i${v}e`);
  if(Array.isArray(v)){const p=[utf8ToBytes('l')];for(const x of v)p.push(bencode(x));p.push(utf8ToBytes('e'));return concatUint8(p);}
  if(typeof v==='object'){const keys=Object.keys(v).sort();const p=[utf8ToBytes('d')];for(const k of keys){p.push(bencode(k));p.push(bencode(v[k]));}p.push(utf8ToBytes('e'));return concatUint8(p);}
  throw new Error('Tipo no soportado');
}
async function sha1(buf){const h=await crypto.subtle.digest('SHA-1',buf);return new Uint8Array(h);}

const zip=document.getElementById('zip'),tracker=document.getElementById('tracker'),
piece=document.getElementById('piecesize'),btn=document.getElementById('generate'),
progress=document.getElementById('progress'),status=document.getElementById('status'),
info=document.getElementById('infoPreview');

function setStatus(msg,err=false){status.textContent=msg;status.style.color=err?'#f87171':'#e2e8f0';}

btn.onclick=async()=>{
  const t=i18n[lang];
  const file=zip.files[0];if(!file){setStatus(t.select,true);return;}
  let pieceLen=parseInt(piece.value);if(!pieceLen||pieceLen<=0)pieceLen=file.size<1e9?256*1024:(file.size<4e9?512*1024:1024*1024);
  setStatus(t.hashing);progress.style.display='block';progress.value=0;
  const total=file.size;const count=Math.ceil(total/pieceLen);let parts=[];
  for(let i=0,off=0;i<count;i++){const end=Math.min(off+pieceLen,total);
    const ab=await file.slice(off,end).arrayBuffer();
    parts.push(await sha1(ab));
    off=end;progress.value=Math.round((i+1)/count*100);
  }
  const pieces=concatUint8(parts);
  const infoDict={'name':file.name,'length':file.size,'piece length':pieceLen,'pieces':pieces};
  const torrent={'info':infoDict};
  if(tracker.value.trim())torrent['announce']=tracker.value.trim();
  info.textContent=JSON.stringify({announce:tracker.value||'(none)',info:{name:file.name,length:file.size,pieces:count}},null,2);
  try{
    const encoded=bencode(torrent);
    const blob=new Blob([encoded],{type:'application/x-bittorrent'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download=file.name.replace(/\.zip$/i,'')+'.torrent';a.click();
    URL.revokeObjectURL(url);
    setStatus(t.done);
  }catch(e){setStatus(t.error+e,true);}
  progress.style.display='none';
};
</script>
</body>
</html>
